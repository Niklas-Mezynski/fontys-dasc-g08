---
title: "Assignment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Introduction
This dataset gives information about the largest online store in Brazil - 'Olist'. Small businesses can use the platform to sell their products on the side and ship them by using the Olist logistic partners.\
The dataset contains (pseudo-) anonymised data of orders from 2016 to 2018.\



Importing the libraries
```{r, echo = FALSE}
library(ggplot2)
library(dplyr)
library(forcats)
library(tidyverse)
```

Reading the CSVs
```{r}
customers <- read.csv("C:\\Users\\nikla\\Documents\\Uni\\Semester_3\\DASC\\Datasets\\BrazilianEcommerce\\olist_customers_dataset.csv")
orders <- read.csv("C:\\Users\\nikla\\Documents\\Uni\\Semester_3\\DASC\\Datasets\\BrazilianEcommerce\\olist_orders_dataset.csv")
order_items <- read.csv("C:\\Users\\nikla\\Documents\\Uni\\Semester_3\\DASC\\Datasets\\BrazilianEcommerce\\olist_order_items_dataset.csv")
```

Joining the tables together
```{r}
orders_customer_items <- orders %>%
  left_join(customers, "customer_id") %>%
  left_join(order_items, "order_id")

head(orders_customer_items, n=10)
```

In this code chunk, we create a new table which contains the average price per order for each state.
Therefore we have to calculate the total order price first and after that we can group by the customer state and calculate the average.
```{r}
avg_order_item_price_by_state <- orders_customer_items %>%
  group_by(order_id) %>%
  summarise(
    order_price = sum(price),
    customer_state = customer_state
  ) %>%
  group_by(customer_state) %>%
  summarise(
    avg_price = round(mean(order_price, na.rm = TRUE), digits = 2)
  )
avg_order_item_price_by_state
```

In this plot you can see the average price per order or each state. 
```{r}
 ggplot(data = avg_order_item_price_by_state, aes(fct_reorder(customer_state, avg_price), avg_price)) +
  geom_col(fill = "#FF6666") +
  ggtitle("Plot of the average price of one order per state") +
  xlab("State") + ylab("Average price per order") +
  theme(
    plot.title = element_text(hjust = 0.5),
)
```

In this plot you can see each states revenue from 2017
```{r}
revenue_by_state <- orders_customer_items %>%
  filter(str_split(order_approved_at, "-", 1) == 2017) %>%
  group_by(customer_state) %>%
  summarise(
    customer_state = customer_state,
    revenue = sum(price)
  )
revenue_by_state
```




# Notes
- Sales per state
- Monthly sales/revenue
- Maybe search a data set which gives info about the economic performance of each state


